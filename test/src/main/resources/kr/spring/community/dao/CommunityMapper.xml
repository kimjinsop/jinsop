<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.spring.community.dao.CommunityMapper">
	<select id="list" parameterType="map" resultType="communityCommand">
		SELECT * FROM (SELECT a.*, rownum rnum FROM 
		(SELECT * FROM community
		<where>
			<if test="keyword!='' and keyfield=='cm_title'">
				cm_title like '%' || #{keyword} || '%'
			</if>
			<if test="keyword!='' and keyfield=='mem_id'">
				mem_id like '%' || #{keyword} || '%'
			</if>
			<if test="keyword!='' and keyfield=='cm_content'">
				cm_content like '%' || #{keyword} || '%'
			</if>
			<if test="keyword!='' and keyfield=='all'">
				cm_title like '%' || #{keyword} || '%' or
				mem_id like '%' || #{keyword} || '%' or
				cm_content like '%' || #{keyword} || '%'
			</if>
		</where>
		ORDER BY cm_num DESC)a where mem_id!='admin')
    <![CDATA[
       WHERE rnum >= #{start} AND rnum <= #{end} 
       ]]>
	</select>
	<select id="getRowCount" parameterType="map" resultType="integer">
		SELECT count(*) FROM community
		<where>
			<if test="keyword!='' and keyfield=='cm_title'">
				cm_title like '%' || #{keyword} || '%'
			</if>
			<if test="keyword!='' and keyfield=='mem_id'">
				mem_id like '%' || #{keyword} || '%'
			</if>
			<if test="keyword!='' and keyfield=='cm_content'">
				cm_content like '%' || #{keyword} || '%'
			</if>
			<if test="keyword!='' and keyfield=='all'">
				cm_title like '%' || #{keyword} || '%' or
				mem_id like '%' || #{keyword} || '%' or
				cm_content like '%' || #{keyword} || '%'
			</if>
			and mem_id!='admin'
		</where>
	</select>

 	<select id="listReply" parameterType="map" resultType="ReplyCommand">
 		select * from (select a.*, rownum rnum from 
 		(select * from reply where cm_num=#{cm_num} order by re_num desc)a)
 		<![CDATA[
 		where rnum>=#{start} and rnum<=#{end}
 		]]>
 	</select>
</mapper>